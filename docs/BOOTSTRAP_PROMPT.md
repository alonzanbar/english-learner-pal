# Bootstrap Application Prompt

Use this prompt to bootstrap a new application from a single **project_id**. It produces a GitHub repository with generic structure, a GCP project with required services, and a single command surface for creation, deployment, and maintenance.

---

## Input

- **project_id** (required): Lowercase identifier; letters, numbers, and hyphens only (e.g. `my-app-name`). Used for GCP project ID and repo/project naming.
- **display_name** (optional): Human-readable name (e.g. `"My App Name"`). Defaults to `project_id`.

---

## One command (full bootstrap)

From the **lexicon-learner-pal** repo root (or any repo that contains `scripts/bootstrap-template/` and `scripts/bootstrap-new-app.sh`):

```bash
./scripts/bootstrap-new-app.sh <project_id> ["Display Name"]
```

This single command:

1. Creates a new project directory (sibling of the current repo).
2. Copies the bootstrap template (root + scripts), substitutes **project_id** and **display_name**.
3. Scaffolds **apps/web** with Vite + React + TypeScript (`npm create vite@latest apps/web -- --template react-ts`).
4. Runs `git init`, first commit.
5. Creates the GitHub repo with `gh repo create <project_id> --public --source=. --remote=origin --push`.

**Prereq:** [GitHub CLI](https://cli.github.com/) installed and authenticated (`gh auth login`). No other steps required for repo creation or file generation. GCP/Firebase one-time setup is done later from the new repo with `./scripts/setup-firebase-project.sh <project_id> ["Display Name"]`.

---

## 1. GitHub repository structure

Create a repository with this layout and generic files.

### Root

- **README.md**  
  - Project title and short description.  
  - “How to edit”: clone, install deps (`cd apps/web && npm i && cd ../..`), run dev (`make dev`).  
  - “Deployment”: link to one-time setup and deploy commands (see sections 2 and 3).  
  - Optional: link to Lovable/IDE/CodeSpaces if applicable.

- **Makefile**  
  - `dev`: run web dev server (e.g. `cd apps/web && npm run dev`).  
  - `deploy-staging`: call deploy script with `staging`.  
  - `deploy-prod`: call deploy script with `prod`.  
  - All targets from repo root.

- **firebase.json**  
  - Hosting: `public: "apps/web/dist"`, `ignore` for `firebase.json`, `**/.*`, `**/node_modules/**`.  
  - Single-page app: `rewrites: [ { "source": "**", "destination": "/index.html" } ]`.

- **.firebaserc** (generated by setup script; can commit a template)  
  - `projects`: `default`, `staging`, `prod` all set to **project_id**.

- **.gitignore**  
  - Standard: `node_modules`, `dist`, `dist-ssr`, `*.local`, logs (`*.log`, `firebase-debug.log`), `.vscode/*` (optional keep `extensions.json`), `.idea`, `.DS_Store`, etc.

### scripts/

- **setup-firebase-project.sh**  
  - Input: `PROJECT_ID` (required), `DISPLAY_NAME` (optional).  
  - Validate `PROJECT_ID`: lowercase, letters, numbers, hyphens only.  
  - Steps:  
    1. Create GCP project: `firebase projects:create "$PROJECT_ID" --display-name "$DISPLAY_NAME"` (allow failure if exists).  
    2. Enable Firebase: `gcloud services enable firebase.googleapis.com --project="$PROJECT_ID"`.  
    3. Grant Firebase Admin to current user: `gcloud projects add-iam-policy-binding "$PROJECT_ID" --member="user:$(gcloud config get-value account)" --role="roles/firebase.admin"`.  
    4. Add Firebase to project: `firebase projects:addfirebase "$PROJECT_ID"`.  
    5. Write `.firebaserc` with `default`/`staging`/`prod` = `PROJECT_ID`.  
  - Prereqs: `firebase login`, `gcloud auth login` (same Google account).  
  - Usage in README: `./scripts/setup-firebase-project.sh <project_id> ["Display Name"]`.

- **deploy-all.sh**  
  - Input: `staging` or `prod`.  
  - Run `deploy-web.sh` with that env.  
  - If `DEPLOY_BACKEND=1` and `apps/backend` exists, run `deploy-backend.sh` with that env.

- **deploy-web.sh**  
  - Input: `staging` or `prod`.  
  - From repo root: `cd apps/web`, `npm ci`, `npm run build`.  
  - Then: `firebase use <ENV>`, `firebase deploy --only hosting`.

- **deploy-backend.sh**  
  - Input: `staging` or `prod`.  
  - If `apps/backend` does not exist, exit 0 with a short message.  
  - Otherwise placeholder for Phase 1 (e.g. Cloud Run + Django); document in README that `DEPLOY_BACKEND=1 make deploy-staging` will be used later.

All scripts: `#!/usr/bin/env bash`, `set -euo pipefail`, resolve `SCRIPT_DIR` and `REPO_ROOT` from script path, and document usage/exit codes.

### apps/web

- Standard Vite + React + TypeScript app: `package.json`, `vite.config.ts`, `index.html`, `src/main.tsx`, `src/App.tsx`, `src/pages/Index.tsx`, Tailwind + shadcn config.  
- Build output: `apps/web/dist` (so Firebase `public` points to `apps/web/dist`).  
- No repo root `package.json` required; all commands go through `Makefile` and `scripts/`.

### Optional

- **apps/backend**: Omitted at bootstrap; add when moving to Phase 1 (backend deploy).

---

## 2. GCP project and services

Creation and wiring are done by **scripts/setup-firebase-project.sh** (see above). That script:

- Creates the GCP project with ID = **project_id** and optional display name.  
- Enables **Firebase Management API** (`firebase.googleapis.com`).  
- Grants **Firebase Admin** to the current gcloud user so `firebase projects:addfirebase` succeeds.  
- Adds Firebase to the project and writes `.firebaserc`.

No manual console steps are required except sign-in (`firebase login`, `gcloud auth login`). If `addfirebase` returns 403, document in README: add Firebase once via Firebase Console (Add project → Add Firebase to existing GCP project), then re-run deploy from repo.

Reusing an existing project: list with `firebase projects:list`, enable `firebase.googleapis.com` for that project, run `firebase projects:addfirebase <PROJECT_ID>`, then set `default`/`staging`/`prod` in `.firebaserc` to that ID.

---

## 3. Command surface (creation, deployment, maintenance)

Single entry point from repo root: **Makefile** and **scripts/**.

### One-time creation (from repo root)

1. Clone the repo (created from the structure above).  
2. Install tools: `npm install -g firebase-tools`, install Google Cloud SDK (e.g. `brew install google-cloud-sdk`).  
3. Sign in: `firebase login`, `gcloud auth login`.  
4. Bootstrap GCP + Firebase and write `.firebaserc`:
   ```bash
   ./scripts/setup-firebase-project.sh <project_id> ["Display Name"]
   ```

### Deployment (from repo root)

- **Staging:** `make deploy-staging` or `./scripts/deploy-all.sh staging`  
- **Production:** `make deploy-prod` or `./scripts/deploy-all.sh prod`  
- **With backend (when added):** `DEPLOY_BACKEND=1 make deploy-staging` or `DEPLOY_BACKEND=1 ./scripts/deploy-all.sh prod`

### Maintenance

- **Local dev:** `make dev` (runs web app dev server).  
- **Switch Firebase project:** `firebase use staging` or `firebase use prod`.  
- **Backend:** When `apps/backend` exists and is implemented, `deploy-backend.sh` is invoked by `deploy-all.sh` when `DEPLOY_BACKEND=1`.

---

## 4. Prompt summary (copy-paste for an AI or automation)

Use this block with **project_id** and optional **display_name** substituted:

```
Bootstrap a new application with:

- project_id: "<project_id>"
- display_name: "<display_name>"   # optional; default "<project_id>"

Deliverables:

1. **GitHub repo** with:
   - Root: README.md (setup, dev, deployment, one-time GCP/Firebase steps), Makefile (dev, deploy-staging, deploy-prod), firebase.json (hosting public=apps/web/dist, SPA rewrite), .firebaserc template (default/staging/prod = project_id), .gitignore.
   - scripts/: setup-firebase-project.sh (create GCP project, enable Firebase API, grant Firebase Admin to user, addFirebase, write .firebaserc), deploy-all.sh (deploy-web + optional deploy-backend when DEPLOY_BACKEND=1), deploy-web.sh (npm ci + build in apps/web, firebase use ENV, firebase deploy --only hosting), deploy-backend.sh (placeholder; no-op if apps/backend missing).
   - apps/web: standard Vite + React + TypeScript + Tailwind + shadcn SPA; build output in apps/web/dist.

2. **GCP**: No separate manual step; setup-firebase-project.sh creates the project, enables Firebase Management API, grants roles, and adds Firebase. Document that firebase login and gcloud auth login are required once.

3. **Commands** (all from repo root):
   - Creation: ./scripts/setup-firebase-project.sh <project_id> ["Display Name"]
   - Dev: make dev
   - Deploy: make deploy-staging | make deploy-prod (optionally DEPLOY_BACKEND=1 when backend exists)

README must document one-time setup (tools, login, setup-firebase-project.sh), deploy commands, and optional backend phase (DEPLOY_BACKEND=1).
```

---

## 5. Validation checklist

After bootstrapping:

- [ ] Repo has README, Makefile, firebase.json, .gitignore, scripts/*.sh, apps/web (Vite/React/TS).  
- [ ] `./scripts/setup-firebase-project.sh <project_id> "Display Name"` runs and writes .firebaserc.  
- [ ] `make dev` starts the web app.  
- [ ] `make deploy-staging` builds apps/web and deploys to Firebase Hosting (after setup).  
- [ ] project_id is lowercase, alphanumeric + hyphens only.
